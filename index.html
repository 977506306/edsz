<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>欢迎访问</title>
    <style>
        body { margin: 0; overflow: hidden; }
        .error-container { 
            display: none; 
            padding: 20px; 
            font-family: Arial, sans-serif;
            text-align: center;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <div id="errorContainer" class="error-container">
        <h1>加载失败</h1>
        <p id="errorMessage">请检查URL参数</p>
    </div>
    
    <iframe id="contentFrame" style="width: 100%; height: 100vh; border: none; display: none;"></iframe>

    <script>
        // 获取URL参数
        function getQueryParam(param) {
            try {
                return new URLSearchParams(window.location.search).get(param);
            } catch (e) {
                console.error('解析URL参数失败:', e);
                return null;
            }
        }

        // 安全解码Base64（处理URL安全格式）
        function safeAtob(encoded) {
            try {
                // 替换URL安全字符
                let base64 = encoded.replace(/-/g, '+').replace(/_/g, '/');
                // 补足长度
                while (base64.length % 4) base64 += '=';
                return atob(base64);
            } catch (e) {
                console.error('Base64解码失败:', e);
                return null;
            }
        }

        // 页面加载后执行
        window.onload = function() {
            const errorContainer = document.getElementById('errorContainer');
            const errorMessage = document.getElementById('errorMessage');
            const contentFrame = document.getElementById('contentFrame');

            try {
                const encodedUrl = getQueryParam('u');
                
                if (!encodedUrl) {
                    throw new Error('缺少必要的URL参数 "u"');
                }
                
                const targetUrl = safeAtob(encodedUrl);
                
                if (!targetUrl) {
                    throw new Error('URL解码失败');
                }
                
                // 验证URL格式（可选增强安全性）
                if (!/^https?:\/\//i.test(targetUrl)) {
                    throw new Error('无效的URL格式');
                }
                
                // 加载内容
                contentFrame.src = targetUrl;
                contentFrame.onload = function() {
                    contentFrame.style.display = 'block';
                    errorContainer.style.display = 'none';
                };
                
                // 设置超时处理
                setTimeout(() => {
                    if (!contentFrame.style.display) {
                        throw new Error('加载超时');
                    }
                }, 10000); // 10秒超时
                
            } catch (error) {
                console.error('加载内容时出错:', error);
                errorMessage.textContent = `错误: ${error.message}`;
                errorContainer.style.display = 'flex';
                contentFrame.style.display = 'none';
            }
        };
    </script>
</body>
</html>
